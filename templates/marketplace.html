{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* FONDO Y AMBIENTE */
    .marketplace-header {
        background: linear-gradient(135deg, #111 0%, #2a2a2a 100%);
        padding: 5rem 0 3rem;
        color: white;
        border-radius: 0 0 30px 30px;
        margin-bottom: 3rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    /* TARJETA DE LUJO */
    .salon-card {
        border: none;
        border-radius: 20px;
        background: #fff;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        overflow: hidden;
        position: relative;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    .salon-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.08);
    }

    /* INITIAL AVATAR (Círculo Lujoso) */
    .initial-avatar {
        width: 80px;
        height: 80px;
        background: #111;
        color: #fff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: 700;
        margin: -40px auto 0;
        border: 4px solid #fff;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        z-index: 2;
        position: relative;
    }

    .card-banner {
        height: 100px;
        background: linear-gradient(45deg, #f3f3f3, #e9ecef);
    }

    /* ICONOS SOCIALES */
    .social-actions a {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        text-decoration: none;
        font-size: 1.1rem;
    }
    .btn-whatsapp { background: #e8f5e9; color: #25D366; }
    .btn-instagram { background: #fce4ec; color: #C13584; }
    .btn-maps { background: #e3f2fd; color: #2196F3; }
    
    .social-actions a:hover { transform: scale(1.1); filter: brightness(0.95); }

    /* FILTROS */
    .filter-bar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 1.5rem;
        border-radius: 50px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        border: 1px solid rgba(0,0,0,0.05);
        margin-top: -60px;
    }
    .form-control-lg, .form-select-lg {
        border: none;
        background: transparent;
        font-size: 1rem;
        box-shadow: none !important;
    }
    .separator { border-left: 1px solid #ddd; height: 40px; margin: 0 15px; }

</style>

<div class="marketplace-header text-center">
    <div class="container">
        <h1 class="fw-bold display-5 mb-2 tracking-wide">Descubre la Excelencia</h1>
        <p class="text-white-50 lead mb-5">Los mejores profesionales de Colombia a tu disposición.</p>
    </div>
</div>

<div class="container position-relative z-2 mb-5">
    <form method="GET" action="." class="filter-bar d-flex flex-column flex-md-row align-items-center">
        <div class="flex-grow-1 w-100 d-flex align-items-center px-3">
            <i class="fas fa-search text-muted me-3"></i>
            <input type="text" name="q" class="form-control form-control-lg" 
                   placeholder="¿Qué servicio buscas? (ej: Corte, Uñas, Spa...)" 
                   value="{{ request.GET.q }}">
        </div>

        <div class="separator d-none d-md-block"></div>

        <div class="w-100 w-md-auto d-flex align-items-center px-3 mt-3 mt-md-0" style="min-width: 250px;">
            <i class="fas fa-map-marker-alt text-muted me-3"></i>
            <select name="city" class="form-select form-select-lg" onchange="this.form.submit()">
                <option value="">Todas las Ciudades</option>
                {% for city in cities %}
                    <option value="{{ city }}" {% if request.GET.city == city %}selected{% endif %}>{{ city }}</option>
                {% endfor %}
            </select>
        </div>
        
        <button type="submit" class="btn btn-dark rounded-pill px-4 py-2 ms-md-3 mt-3 mt-md-0 fw-bold">
            Explorar
        </button>
    </form>
    
    <div class="text-center mt-4">
        <a href="?city=Tunja" class="btn btn-link text-decoration-none text-dark fw-bold small">
            <i class="fas fa-location-arrow me-1 text-primary"></i> Ver negocios cerca a mí
        </a>
    </div>
</div>

<div class="container pb-5">
    <div class="row g-4">
        {% for salon in salons %}
        <div class="col-md-6 col-lg-4">
            <div class="card salon-card shadow-sm h-100">
                <div class="card-banner"></div>
                
                <div class="initial-avatar shadow">
                    {{ salon.name|slice:":1"|upper }}
                </div>

                <div class="card-body text-center pt-2">
                    <h5 class="fw-bold mb-1">{{ salon.name }}</h5>
                    <p class="text-muted small mb-3"><i class="fas fa-map-marker-alt me-1"></i> {{ salon.city }}</p>

                    <p class="card-text text-muted small mb-4 px-3" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                        {% if salon.description %}
                            {{ salon.description }}
                        {% else %}
                            Experiencia premium en belleza y cuidado personal.
                        {% endif %}
                    </p>

                    <div class="social-actions d-flex justify-content-center gap-2 mb-4">
                        {% if salon.whatsapp_number %}
                            <a href="https://wa.me/{{ salon.whatsapp_number }}" target="_blank" class="btn-whatsapp" title="Reservar por WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        {% endif %}
                        
                        {% if salon.instagram_link %}
                            <a href="{{ salon.instagram_link }}" target="_blank" class="btn-instagram" title="Ver Instagram">
                                <i class="fab fa-instagram"></i>
                            </a>
                        {% endif %}
                        
                        {% if salon.maps_link %}
                            <a href="{{ salon.maps_link }}" target="_blank" class="btn-maps" title="Ver Ubicación">
                                <i class="fas fa-map-marked-alt"></i>
                            </a>
                        {% endif %}
                    </div>

                    <div class="d-grid px-3">
                        <a href="{% url 'salon_detail' salon.id %}" class="btn btn-dark rounded-pill py-2 fw-bold">
                            Ver Servicios y Reservar
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <div class="display-1 text-muted mb-3"><i class="fas fa-search"></i></div>
            <h3>No encontramos resultados</h3>
            <p class="text-muted">Intenta con otra ciudad o descripción.</p>
            <a href="{% url 'marketplace' %}" class="btn btn-outline-dark rounded-pill">Ver todo</a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
