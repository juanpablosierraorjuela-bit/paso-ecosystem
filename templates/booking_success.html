
{% extends 'base_saas.html' %}
{% block content %}
<div class="row justify-content-center align-items-center py-5">
    <div class="col-md-5">
        
        <div class="card border-0 p-0 shadow-lg overflow-hidden rounded-4">
            
            <div class="p-4 text-center position-relative text-white" 
                 style="background: {% if salon.bold_identity_key %}linear-gradient(135deg, #1C1C1C 0%, #333 100%){% else %}linear-gradient(135deg, #198754 0%, #20c997 100%){% endif %};">
                
                <div class="position-relative z-1">
                    {% if salon.bold_identity_key %}
                        <h5 class="text-uppercase text-white-50 small fw-bold ls-1">Resumen de Pago</h5>
                        <h1 class="display-4 fw-bold text-warning mb-0">${{ deposit_amount|floatformat:0 }}</h1>
                        <span class="badge bg-warning text-dark mt-2">Abono del {{ deposit_percent }}%</span>
                    {% else %}
                        <h5 class="text-uppercase text-white-50 small fw-bold ls-1">¡Reserva Confirmada!</h5>
                        <h1 class="display-4 fw-bold mb-0">${{ total_value|floatformat:0 }}</h1>
                        <span class="badge bg-light text-success mt-2 fw-bold">Pago Total en el Local</span>
                    {% endif %}
                </div>
            </div>

            <div class="card-body p-4 bg-white">
                
                <div class="mb-3 border-bottom pb-3">
                    {% for item in group_bookings %}
                    <div class="d-flex justify-content-between mb-2 text-muted">
                        <span>{{ item.service.name }}</span>
                        <span class="fw-bold text-dark">${{ item.service.price|floatformat:0 }}</span>
                    </div>
                    {% endfor %}
                    
                    {% if salon.bold_identity_key %}
                    <div class="d-flex justify-content-between mt-3 text-dark">
                        <span class="small">Valor Total Servicios</span>
                        <span class="fw-bold">${{ total_value|floatformat:0 }}</span>
                    </div>
                    {% endif %}
                </div>

                {% if salon.bold_identity_key %}
                    <div class="alert alert-info border-0 d-flex align-items-center mt-4" role="alert">
                        <i class="fas fa-info-circle fs-4 me-3"></i>
                        <div class="small lh-sm">
                            Pagas <strong>${{ deposit_amount|floatformat:0 }}</strong> ahora.<br>
                            Restan <strong>${{ pending_amount|floatformat:0 }}</strong> en el local.
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-success border-0 d-flex align-items-center mt-4" role="alert">
                        <i class="fas fa-check-circle fs-2 me-3"></i>
                        <div class="small lh-sm">
                            <strong>¡Todo listo!</strong><br>
                            Tu cita ya fue agendada y notificada al salón. No necesitas pagar nada ahora.
                        </div>
                    </div>
                {% endif %}

                {% if salon.bold_identity_key %}
                    <form action="https://checkout.bold.co/payment/init" method="POST">
                        <input type="hidden" name="apikey" value="{{ salon.bold_identity_key }}">
                        <input type="hidden" name="orderId" value="{{ order_id }}">
                        <input type="hidden" name="amount" value="{{ deposit_amount }}">
                        <input type="hidden" name="currency" value="COP">
                        <input type="hidden" name="description" value="Reserva en {{ salon.name }}">
                        <input type="hidden" name="integritySignature" value="{{ bold_signature }}">
                        <input type="hidden" name="redirectionUrl" value="{{ request.scheme }}://{{ request.get_host }}/mis-citas/">

                        <button type="submit" class="btn btn-dark w-100 py-3 rounded-pill shadow-lg fw-bold fs-5 mt-2">
                            <i class="fas fa-lock me-2 text-warning"></i> Pagar Abono Seguro
                        </button>
                    </form>
                    <div class="text-center mt-3">
                        <small class="text-muted"><i class="fas fa-shield-alt text-success"></i> Procesado por Bold.co</small>
                    </div>

                {% else %}
                    <div class="d-grid mt-3">
                        <a href="{% url 'dashboard' %}" class="btn btn-outline-success w-100 py-3 rounded-pill fw-bold">
                            Ver mis Citas <i class="fas fa-arrow-right ms-2"></i>
                        </a>
                    </div>
                    <div class="text-center mt-3">
                        <small class="text-muted">Te esperamos puntualmente.</small>
                    </div>
                {% endif %}

            </div>
        </div>

    </div>
</div>
{% endblock %}
